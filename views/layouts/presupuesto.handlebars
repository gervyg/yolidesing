<!DOCTYPE html>
<html lang="es" dir="ltr">

{{>head}}

<body>
    
{{> encabezado sesion=true}}

   
<h1 class="text-alig-center py-5 px-5 my-5 mx-5 " style="padding-top: 6rem!important;">Solicitud De Presupuesto</h1>

<section>
  <div class="row col-sm-12">
    
<div  id="btnlista"class="col-sm-12 mx-5 py-5">
   <button id="btnenviar" class="butoon-primary text aling-left text-white">LISTA DE PRODUCTOS</button>
   <button id="btnenviar">
   <a  class="butoon-primary text aling-left text-white" href="/cliente/presupuesto/lista"> <i class="fa-solid fa-magnifying-glass"></i>LISTA DE PRESUPUESTOS</a>
   </button>
   </div>
   </div> 
</section>


<section class="col-sm-12">
<div  >
<h5 id="tituloprod" class="text-center" >PRODUCTOS</h5>
</div>
</section>


<div  class="container col-sm-12" >  
<div id="items" class="row ">
  <main  class=" row align-center"></main>
  <aside class="col-sm-12" >
<table id="tabla" class="table table-dark ">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col"></th>
            <th scope="col">Articulo</th>
            <th scope="col">Precio</th>
            <th scope="col">Descripcion</th>                    
            <th scope="col">Seleccion de Producto</th>
          </tr>
        </thead>
        <tbody>
         
          {{#each productos}}
              <tr>
                  <th>{{this.id}}</th>  
                   <td><div> <a> <img id="imgTable" class="imgTable" src="/static/assets/img/{{this.foto}}" alt=""> </a> </div></td>
                   <th>{{this.articulo}}</th>               
                  <td>{{this.precio}}</td>
                  <td>{{this.descripcion}}</td>                  
                  <td> <button class="btn-primary" onclick="agregarProducto('{{id}}','{{foto}}','{{articulo}}','{{this.precio}}')">+</button> </td>
                                   
              </tr>
          {{/each}}
        </tbody>
      </table>
      
      </aside>
</div>
</div>


<div id="containerpresu" class="container-fluid mx-0 row col-sm-12 aling-left"></div>


<section id="observacion" class="col-sm-12 alig-center mx-5 py-5">

<div class="col-sm-6 mx-auto">
<textarea  name="observacion" class="form-control" cols="15" rows="5">Observacion: </textarea>
</div>

</section>


<section class="col-sm-12 alig-center mx-5 py-5">
<p class="aling-left mx-5 py-5">Nota: Presupuesto válido por tres dias a contar de la fecha de emisión </p>

<div id="totales" class=" col-sm-6 mx-5 px-5 " >
<p class="text-right">Total Neto: <span id="totalneto"></span>$</p>
<p class="text-right">Iva: <span id="iva"></span>$</p>
<p class="text-right">Total: <span id="total"></span>$</p>
</div>
</section>


<section class="row col-sm-12  mx-auto py-5">
<div class="col-sm-6 mx-auto">

<button id="btnenviar" type="submit" class="btn btn-info mb-3 my-5 text-white">ACEPTAR</button>
<button id="btnenviar" type="button" class="btn btn-info mb-3 my-5 text-white">CANCELAR</button>
</div>

</section>



{{>footer}}
 
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"></script>

      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"></script>
      
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" 
     integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" 
     crossorigin="anonymous">
      
       <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" 
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" 
      crossorigin="anonymous"></script>

      

</body>

</html>



<script>

const productosSeleccionados =  new Set();   

const agregarProducto = (id, foto, articulo, precio) =>{
 
  const obj = {
    id: id,
    foto:foto,
    articulo: articulo,
    precio:precio,
    cantidad: 1
  }

  const noDulplicar = Array.from(productosSeleccionados).filter(element => element.id === id);
  if(noDulplicar.length == 0){
    productosSeleccionados.add(obj);
  }else{
    noDulplicar[0].cantidad = noDulplicar[0].cantidad +1;
  }
  
  let div = document.getElementById("containerpresu");
  div.innerHTML = ""; 
  productosSeleccionados.forEach((producto, indice) => {
        div.innerHTML +=`<div class="col-sm-4" >  
              <img id="imgTable" class="imgTable" src="/static/assets/img/${producto.foto}" alt="">
            </div> 
            <div class="col-sm-4" >
                    <h2>${producto.articulo}</h2>
                    <p>${producto.precio}</p>
            </div>   
            <div class="col-sm-4" >
              <p id="cantidad" class="aling-right">Cantidad ${producto.cantidad}</p>  
                <div id="icodel" onclick ="eliminarProducto('${producto.id}')"><i class="fa-solid fa-trash-can"></i></div>
            </div>`});
  
}; 

const eliminarProducto = (id) =>{
    
  const busqueda = Array.from(productosSeleccionados).filter(element => element.id === id);
  productosSeleccionados.delete(busqueda[0]);
  let div = document.getElementById("containerpresu");
  div.innerHTML = ""; 
  productosSeleccionados.forEach((producto, indice) => {
        div.innerHTML +=`<div class="col-sm-4" >  
              <img id="imgTable" class="imgTable" src="/static/assets/img/${producto.foto}" alt="">
            </div> 
            <div class="col-sm-4" >
                    <h2>${producto.articulo}</h2>
                    <p>${producto.precio}</p>
            </div>   
            <div class="col-sm-4" >
              <p id="cantidad" class="aling-right">Cantidad ${producto.cantidad}</p>  
                <div id="icodel" onclick ="eliminarProducto('${producto.id}')"><i class="fa-solid fa-trash-can"></i></div>
            </div>`});

}

</script>